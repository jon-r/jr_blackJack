window.addEventListener("ready",function(a){"use strict";function b(o){let p=o[0];return 1==p?11:10<p?10:p}function c(o,p){return o.className=`card ${["diamonds","hearts","spades","clubs"][p[1]]}`,o.appendChild(d("span",{text:{"1":"A","11":"J","12":"Q","13":"K"}[p[0]]||p[0]})),o}function d(o,p){let q=a.createElement(o);for(var r in p)if(("styles"===r||"style"===r)&&"object"==typeof p[r])for(var s in p[r])q.style[s]=p[r][s];else"text"===r?q.textContent=p[r]:q.setAttribute(r,p[r]);return q}function f(o,p){function q(v,w){u=setTimeout(function(){if(u=null,v(),r.length){var x=r.shift();q(x.fn,x.t)}},w)}var s,u,r=[];return s={delay:function(v,w){return r.length||u?r.push({fn:v,t:w}):q(v,w),s},cancel:function(){clearTimeout(u),r=[]}},s.delay(o,p)}class g{constructor(o){this.deckCount=o,this.setDeck()}setDeck(){this.cards=[];for(let o=0;o<this.deckCount;o++)for(let p=0;4>p;p++)for(let q=1;14>q;q++)this.cards.push([q,p])}drawOne(){let o=Math.floor(Math.random()*this.cards.length);return this.cards.splice(o,1)[0]}}class h{constructor(o){this.name=o,this.cardCount=0,this.score=0,this.hand=[],this.hardAce=!0,this.output={hand:null,score:"0",title:""}}reset(){this.cardCount=0,this.score=0,this.hand=[],this.hardAce=!0;let o=this.output;for(o.score.textContent="0";o.hand.firstChild;)o.hand.removeChild(o.hand.firstChild)}deal(o){let p=this.output.frame,q=o.control.table.offsetWidth-p.offsetLeft-20*this.cardCount,r=-1*p.offsetTop,s=d("div",{"class":"card draw blank",style:{transform:`translate(${q}px, ${r}px)`}});this.output.hand.appendChild(s),this.cardCount++,window.getComputedStyle(s).transform,s.style.transform=""}hit(o){let p=this.hand.length;if(p<this.cardCount){let r,q=o.deck.drawOne();this.hand.push(q),this.revealCard(p,q),this.score+=b(q),r=this.getScore(),this.output.score.textContent=r.scoreStr,r.endTurn&&m.stand(o)}else f(()=>this.deal(o),0).delay(()=>this.hit(o),200)}revealCard(o,p){let q=this.output.hand.getElementsByClassName("card")[o];q.className="card blank",f(()=>q.style.transform="translateY(-80px) rotateX(-90deg)",0).delay(()=>c(q,p),150).delay(()=>q.style.transform="rotateX(0)",150)}autoPlay(o){setTimeout(()=>{17>this.score&&(this.hit(o),this.autoPlay(o))},500)}getScore(){let o="0",p=!1,q=3>this.cardCount,r=this.hand.some(u=>1===u[0]),s=this.score;return q&&21==s?(o=`BlackJack ${s}`,p=!0):q&&r?(o=`Soft ${s}`,this.hardAce=!1):21==s?(o=s,p=!0):21<s&&!this.hardAce?(s=this.score=s-10,this.hardAce=!0,o=s):21<s?(o=`Bust ${s}`,p=!0):o=s,{scoreStr:o,endTurn:p}}}class l{constructor(o){this.table=a.querySelector(o.config.tableElement);let p=this.setPanel();p.addEventListener("click",r=>{let s=r.target.dataset.ctrl;s&&m[s](o)},!1);let q=o.players.map(this.setOutputs);q.concat([p]).forEach(r=>this.table.appendChild(r))}setPanel(){let o=d("div",{"class":"control-box"});return["hit","stand","restart"].forEach(p=>{const q=d("button",{"class":`ctrl ctrl-${p}`,text:p,"data-ctrl":p});o.appendChild(q)}),o}setOutputs(o,p){let q=d("div",{"class":`player-frame player-${p}`}),r=new Map([["score","0"],["title",o.name],["hand",""]]);o.output.frame=q;for(let[s,u]of r){let v=d("div",{"class":s,text:u});q.appendChild(v),o.output[s]=v}return q}}const m={hit:function(o){o.players[o.currentPlayer].hit(o)},stand:function(o){o.nextPlayer(),0==o.currentPlayer&&o.players[o.currentPlayer].autoPlay(o)},restart:function(o){o.newGame()}};return new class{constructor(p){this.config=this.setConfig(p),this.currentPlayer=1,this.deck=new g(this.config.deckCount),this.players=this.config.players.map(q=>new h(q)),this.control=new l(this),this.dealAll()}setConfig(p){return p=p||{},{tableElement:p.tableElement||"#jr_cardTable",deckCount:p.deckCount||6,players:["Dealer"].concat(p.players||["player-1"])}}newGame(){this.currentPlayer=1,this.deck.setDeck(),this.players.map(p=>p.reset()),this.dealAll()}dealAll(){let p=this.players,q=p[this.currentPlayer],r=p[0];setTimeout(()=>{q.deal(this),this.nextPlayer(),2>r.cardCount&&this.dealAll()},300)}nextPlayer(){let p=this.currentPlayer;this.players[p].output.title.classList.remove("active"),this.currentPlayer=p==this.players.length-1?0:p+1,this.players[this.currentPlayer].output.title.classList.add("active")}}({deckCount:6,players:["Adam","Beth","Chris","Denise","Edward"]})}(document));
