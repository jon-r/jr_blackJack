var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(f,k,l){if(l.get||l.set)throw new TypeError("ES3 does not support getters and setters.");f!=Array.prototype&&f!=Object.prototype&&(f[k]=l.value)};$jscomp.getGlobal=function(f){return"undefined"!=typeof window&&window===f?f:"undefined"!=typeof global&&null!=global?global:f};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(f){return $jscomp.SYMBOL_PREFIX+(f||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var f=$jscomp.global.Symbol.iterator;f||(f=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[f]&&$jscomp.defineProperty(Array.prototype,f,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(f){var k=0;return $jscomp.iteratorPrototype(function(){return k<f.length?{done:!1,value:f[k++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(f){$jscomp.initSymbolIterator();f={next:f};f[$jscomp.global.Symbol.iterator]=function(){return this};return f};$jscomp.makeIterator=function(f){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var k=f[Symbol.iterator];return k?k.call(f):$jscomp.arrayIterator(f)};
window.addEventListener("ready",function(f){function k(a,b){a=f.createElement(a);for(var d in b)if("styles"!==d&&"style"!==d||"object"!==typeof b[d])"text"===d?a.textContent=b[d]:a.setAttribute(d,b[d]);else for(var c in b[d])a.style[c]=b[d][c];return a}function l(a,b){function d(a,b){f=setTimeout(function(){f=null;a();if(c.length){var b=c.shift();d(b.fn,b.t)}},b)}var c=[],e,f;e={delay:function(a,b){c.length||f?c.push({fn:a,t:b}):d(a,b);return e},cancel:function(){clearTimeout(f);c=[]}};return e.delay(a,
b)}var g=function(a){this.table=f.querySelector(a||"[data-blackjack]");this.current=1;this.options;this.players;this.activeCount;this.ui;this.decksCount;this.menu=new m(this.table,this.gamePlay.new)};g.prototype.newGame=function(a){a=a||{};for(var b=this.table;b.firstChild;)b.removeChild(b.firstChild);this.options={deckCount:a.deckCount||6,players:["Dealer"].concat(a.players||["player-1"])};this.players=this.options.players.map(function(a){return new n(a)});this.activeCount=this.players.length;this.deck=
new p(this.options.deckCount);this.ui=new h(this);this.dealAll()};g.prototype.restart=function(){var a=this;this.current=1;this.players.map(function(b,d){b.restart();b.skip&&d==a.current&&a.current++});this.ui.restart();this.dealAll()};g.prototype.dealAll=function(){var a=this,b=this.ui.playerOutputs[0];this.ui.deal(this.current);this.ui.getButton("ctrl-hit").disabled=!0;this.ui.getButton("ctrl-stand").disabled=!0;setTimeout(function(){a.nextPlayer();2>b.cardCount?a.dealAll():(a.current=0,a.playerHit(),
a.ui.getButton("ctrl-bid").disabled=a.ui.checkBids(),a.nextPlayer())},100)};g.prototype.placeBids=function(){this.ui.getButton("ctrl-bid").disabled=!0;if(!this.ui.checkBids()){for(var a=this.players.length,b=1;b<a;b++){var d=this.players[b];d.skip||(d.bid=this.ui.getBid(b))}this.ui.getButton("ctrl-hit").disabled=!1;this.ui.getButton("ctrl-stand").disabled=!1;this.firstDeal()}};g.prototype.firstDeal=function(){var a=this;l(function(){return a.playerHit()},500).delay(function(){return a.playerHit()},
500)};g.prototype.playerHit=function(){var a=this.deck.deal(),b=this.players[this.current].draw(a);this.ui.hit(this.current,a,b.scoreStr);b.endTurn&&0<this.current&&this.playerStand()};g.prototype.playerStand=function(){this.nextPlayer();0==this.current?(this.ui.getButton("ctrl-hit").disabled=!0,this.ui.getButton("ctrl-stand").disabled=!0,this.autoPlay()):this.firstDeal()};g.prototype.nextPlayer=function(){var a=this.players;this.current=(this.current+1)%a.length;a[this.current].skip?this.nextPlayer():
this.ui.setActive(this.current)};g.prototype.autoPlay=function(){var a=this,b=this.players[this.current];setTimeout(function(){17>b.score?(a.playerHit(),a.autoPlay(b)):a.endRound()},500)};g.prototype.endRound=function(){for(var a=this,b=this.players[0],d=this.players.length,c=1;c<d;c++){var e=this.players[c],f=e.getMoney(b.score,b.cardCount);this.ui.setMoney(c,f);0!=e.money||e.skip||(e.skip=!0,this.ui.knockout(c),this.activeCount--)}setTimeout(function(){1==a.activeCount?a.endAll():a.restart()},2E3)};
g.prototype.endAll=function(){console.log("game over")};$jscomp.global.Object.defineProperties(g.prototype,{gamePlay:{configurable:!0,enumerable:!0,get:function(){var a=this;return{new:function(b){return a.newGame(b)},hit:function(){return a.playerHit()},stand:function(){return a.playerStand()},menu:function(){return a.menu.toggleForm()},bid:function(){return a.placeBids()}}}}});var m=function(a,b){this.build(a);this.form;this.optsFn=b};m.prototype.build=function(a){var b=this,d=a.parentElement.insertBefore(k("form",
{class:"intro-form"}),a);a=new Map([["decks",["Deck Count","number",6]],["p-1",["Player 1","text","Aaron"]],["p-2",["Player 2","text","Beth"]],["p-3",["Player 3","text","Chris"]],["p-4",["Player 4","text","Denise"]],["p-5",["Player 5","text","Ethan"]],["submit",["New Game","submit","Go"]]]);a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next()){var e=$jscomp.makeIterator(c.value),c=e.next().value,e=e.next().value,f=k("label",{class:"form-label label-"+c+" label-"+e[1],for:"input-"+c,text:e[0]}),
c=k("input",{class:"form-input input-"+c+" input-"+e[1],name:c,type:e[1],placeholder:e[0],id:"input-"+c,value:e[2]||"",min:"number"==e[1]?1:""});[f,c].forEach(function(a){return d.appendChild(a)});"text"==e[1]&&(e=k("button",{class:"clear-player",text:"X"}),e.addEventListener("click",function(a){a.preventDefault();a.target.nextElementSibling.value=""}),d.insertBefore(e,c))}d.addEventListener("submit",function(a){a.preventDefault();b.setupGame(a.target.elements);d.classList.add("inactive")});this.form=
d};m.prototype.toggleForm=function(){this.form.classList.toggle("inactive")};m.prototype.setupGame=function(a){for(var b={deckCount:a[0].value,players:[]},d=1,c=a.length-1;d<c;d++){var e=a[d].value;""!==e&&b.players.push(e)}this.optsFn(b)};var p=function(a){this.cards=[];this.count=a;this.build()};p.prototype.build=function(){for(var a=0;a<this.count;a++)for(var b=0;4>b;b++)for(var d=1;14>d;d++)this.cards.push([d,b])};p.prototype.restart=function(){this.cards=[];this.build()};p.prototype.deal=function(){var a=
this.cards.splice(Math.floor(Math.random()*this.cards.length),1)[0],b=a[0],d={1:["A",11],11:["J",10],12:["Q",10],13:["K",10]},c={suit:["diamonds","hearts","spades","clubs"][a[1]],face:b,score:b};a[0]in d&&(c.face=d[b][0].charAt(0),c.score=d[b][1]);return c};var n=function(a){this.name=a;this.cardCount=0;this.money=1E3;this.score=this.bid=0;this.hand=[];this.hardAce=!0;this.skip=!1};n.prototype.restart=function(){this.score=this.cardCount=0;this.hand=[];this.bid=0;this.hardAce=!0};n.prototype.draw=
function(a){this.cardCount++;this.hand.push(a);this.score+=a.score;var b="0";a=!1;var b=3>this.cardCount,d=this.hand.some(function(a){return"A"==a.face}),c=this.score;b&&21==c?(b="BlackJack "+c,a=!0):d&&21>c?(b="Soft "+c,this.hardAce=!1):21==c?(b=c,a=!0):21<c&&!this.hardAce?(b=this.score=c-10,this.hardAce=!0):21<c?(b="Bust "+c,a=!0):b=c;return{scoreStr:b,endTurn:a}};n.prototype.getMoney=function(a,b){var d=this.score;b=21==a&&3>b;var c=21==d&&3>this.cardCount;return this.money+=this.bid*(22>d?c&&
!b?1.5:d>a||21<a?1:c&&b||d==a?0:-1:-1)};var h=function(a){this.table=a.table;this.playerOutputs=a.players.map(this.buildPlayer,this);this.panel=this.buildPanel();this.panel.addEventListener("click",function(b){if(b=b.target.dataset.ctrl)a.gamePlay[b]()},!1)};h.prototype.buildPanel=function(){var a=k("div",{"class":"control-box"});["bid","hit","stand","menu"].forEach(function(b){b=k("button",{"class":"ctrl ctrl-"+b,text:b,"data-ctrl":b});a.appendChild(b)});this.table.appendChild(a);return a};h.prototype.getButton=
function(a){return this.panel.getElementsByClassName(a)[0]};h.prototype.buildPlayer=function(a,b){for(var d=this,c=k("div",{"class":"player-frame player-"+b}),e={bid:500,cardCount:0,childEls:{},hand:[],goX:0,goY:0,skip:!1},f=new Map([["score",["0",!0]],["title",[a.name,!0]],["money",[a.money]],["difference",["0"]],["hand",["",!0]]]),f=$jscomp.makeIterator(f),h=f.next();!h.done;h=f.next()){var g=$jscomp.makeIterator(h.value),h=g.next().value,g=g.next().value;if(0<b||g[1])g=k("div",{"class":h,text:g[0]}),
c.appendChild(g),e.childEls[h]=g}0<b&&(a=k("input",{type:"number","class":"playerBet",min:Math.min(100,a.money),max:a.money,value:e.bid}),a.addEventListener("change",function(a){a=d.checkBid(a.target);d.getButton("ctrl-bid").disabled=a}),e.childEls.bid=a,c.appendChild(a));this.table.appendChild(c);e.goX=this.table.offsetWidth-c.offsetLeft;e.goY=-c.offsetTop;return e};h.prototype.restart=function(){for(var a=this.playerOutputs,b=a.length,d=0;d<b;d++){var c=a[d],e=c.childEls,f=e.hand;c.hand=[];c.cardCount=
0;0<d&&(c=e.money.textContent,e.bid.disabled=!1,e.bid.setAttribute("max",c),e.bid.setAttribute("min",Math.min(100,c)));for(e.score.textContent="0";f.firstChild;)f.removeChild(f.firstChild)}};h.prototype.setActive=function(a){a=this.playerOutputs[a];this.playerOutputs.forEach(function(a){a.childEls.title.classList.remove("active")});a.childEls.title.classList.add("active")};h.prototype.knockout=function(a){a=this.playerOutputs[a];a.childEls.title.classList.add("inactive");a.childEls.bid.value=0;a.skip=
!0};h.prototype.getBid=function(a){a=this.playerOutputs[a].childEls.bid;a.disabled=!0;return a.value};h.prototype.checkBid=function(a){var b=!a.validity.valid;b?a.classList.add("invalid"):a.classList.remove("invalid");return b};h.prototype.checkBids=function(){for(var a=0,b=this.playerOutputs,d=b.length,c=1;c<d;c++){var e=b[c];!e.skip&&this.checkBid(e.childEls.bid)&&a++}return 0<a};h.prototype.setMoney=function(a,b){var d=this.playerOutputs[a].childEls;a=b-d.money.textContent;var c;0!==a&&(c=0<a?
"pos":"neg",d.difference.textContent=a,d.difference.classList.add("show-"+c),d.money.textContent=b,setTimeout(function(){d.difference.classList.remove("show-"+c)},5E3))};h.prototype.deal=function(a){a=this.playerOutputs[a];var b=k("div",{"class":"card draw blank",style:{transform:"translate("+(a.goX-20*a.cardCount)+"px, "+a.goY+"px)"}});a.cardCount++;a.childEls.hand.appendChild(b);window.getComputedStyle(b).transform;b.style.transform=""};h.prototype.hit=function(a,b,d){var c=this,e=this.playerOutputs[a],
f=e.hand.length;e.childEls.score.textContent=d;f<e.cardCount?(e.hand.push(b),this.reveal(a,f,b)):l(function(){return c.deal(a)},0).delay(function(){return c.hit(a,b,d)},200)};h.prototype.reveal=function(a,b,d){var c=this,e=this.playerOutputs[a].childEls.hand.getElementsByClassName("card")[b];e.className="card blank";l(function(){return e.style.transform="translateY(-80px) rotateX(-90deg)"},0).delay(function(){return c.setCard(e,d)},150).delay(function(){return e.style.transform=""},150)};h.prototype.setCard=
function(a,b){a.className="card "+b.suit;a.appendChild(k("span",{text:b.face}))};return new g}(document));
